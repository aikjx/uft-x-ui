<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»Ÿä¸€åœºè®º - ç»ˆæ3Då¯è§†åŒ–ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); }
            50% { box-shadow: 0 0 40px rgba(0, 212, 255, 0.6); }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(0.98); }
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', -apple-system, sans-serif;
            background: radial-gradient(ellipse at center, #0a0e1a 0%, #000000 100%);
            color: #fff;
            overflow: hidden;
            position: relative;
            cursor: grab;
        }
        
        body.grabbing {
            cursor: grabbing;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        /* ä¸»æ§åˆ¶é¢æ¿ */
        .main-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
            background: linear-gradient(135deg, 
                rgba(10, 14, 26, 0.96) 0%, 
                rgba(20, 24, 36, 0.94) 50%,
                rgba(10, 14, 26, 0.96) 100%);
            padding: 20px;
            border-radius: 20px;
            border: 2px solid transparent;
            max-width: 420px;
            max-height: 96vh;
            overflow-y: auto;
            backdrop-filter: blur(30px) saturate(180%);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.9),
                0 0 60px rgba(0, 212, 255, 0.15),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
            animation: glow 3s ease-in-out infinite;
        }
        
        .main-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            padding: 2px;
            background: linear-gradient(135deg, #00d4ff, #7b2ff7, #f107a3);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0.6;
            z-index: -1;
        }
        
        .main-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }
        
        .main-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #00d4ff, #7b2ff7, #f107a3);
            border-radius: 3px;
        }
        
        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            background: linear-gradient(120deg, 
                #00d4ff 0%, 
                #7b2ff7 30%, 
                #f107a3 60%,
                #00d4ff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            letter-spacing: 1px;
            animation: shimmer 3s linear infinite;
            filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.5));
        }
        
        .subtitle {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 16px;
            font-style: italic;
            line-height: 1.4;
        }
        
        /* æ¨¡å¼é€‰æ‹©å™¨ */
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 18px;
        }
        
        .mode-btn {
            padding: 12px 8px;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.25);
            border-radius: 10px;
            color: #aaa;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.85em;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .mode-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 212, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .mode-btn:hover::before {
            width: 200px;
            height: 200px;
        }
        
        .mode-btn:hover {
            background: rgba(0, 212, 255, 0.15);
            border-color: rgba(0, 212, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, 
                rgba(0, 212, 255, 0.3), 
                rgba(123, 47, 247, 0.3));
            border-color: #00d4ff;
            color: #00d4ff;
            font-weight: bold;
            box-shadow: 
                0 0 20px rgba(0, 212, 255, 0.5),
                inset 0 1px 1px rgba(255, 255, 255, 0.2);
        }
        
        /* ç« èŠ‚ */
        .section {
            margin: 14px 0;
            padding: 16px;
            background: linear-gradient(135deg,
                rgba(0, 212, 255, 0.03) 0%,
                rgba(123, 47, 247, 0.02) 100%);
            border-radius: 12px;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            background: linear-gradient(135deg,
                rgba(0, 212, 255, 0.08) 0%,
                rgba(123, 47, 247, 0.05) 100%);
            transform: translateX(3px);
        }
        
        .section.geo { 
            border-color: #00d4ff;
            box-shadow: -4px 0 20px rgba(0, 212, 255, 0.15);
        }
        .section.force { 
            border-color: #7b2ff7;
            box-shadow: -4px 0 20px rgba(123, 47, 247, 0.15);
        }
        .section.control { 
            border-color: #f107a3;
            box-shadow: -4px 0 20px rgba(241, 7, 163, 0.15);
        }
        .section.formula { 
            border-color: #ffd93d;
            box-shadow: -4px 0 20px rgba(255, 217, 61, 0.15);
        }
        .section.camera {
            border-color: #4CAF50;
            box-shadow: -4px 0 20px rgba(76, 175, 80, 0.15);
        }
        
        .section h3 {
            font-size: 0.98em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .section.geo h3 { color: #00d4ff; }
        .section.force h3 { color: #7b2ff7; }
        .section.control h3 { color: #f107a3; }
        .section.formula h3 { color: #ffd93d; }
        .section.camera h3 { color: #4CAF50; }
        
        /* åŠ›ç±»å‹å¡ç‰‡ */
        .force-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .force-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(180deg, transparent, currentColor, transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .force-card:hover::before {
            opacity: 1;
        }
        
        .force-card:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.4);
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.2);
        }
        
        .force-card.active {
            background: linear-gradient(90deg, 
                rgba(0, 212, 255, 0.2), 
                rgba(123, 47, 247, 0.15));
            border-color: #00d4ff;
            box-shadow: 
                0 0 15px rgba(0, 212, 255, 0.3),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
        }
        
        .force-info {
            flex: 1;
        }
        
        .force-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .force-icon {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            animation: float 3s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .force-name {
            font-size: 0.92em;
            font-weight: 600;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .force-origin {
            font-size: 0.72em;
            color: #999;
            margin-left: 44px;
            line-height: 1.4;
        }
        
        .force-direction {
            font-size: 0.7em;
            color: #00d4ff;
            margin-left: 44px;
            margin-top: 3px;
            font-weight: 500;
        }
        
        /* å¼€å…³ */
        .toggle-switch {
            width: 46px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .toggle-switch.active {
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            box-shadow: 
                inset 0 1px 2px rgba(255, 255, 255, 0.3),
                0 0 15px rgba(0, 212, 255, 0.5);
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #ffffff, #f0f0f0);
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        
        .toggle-switch.active::after {
            left: 25px;
            box-shadow: 0 2px 8px rgba(0, 212, 255, 0.6);
        }
        
        /* å…¬å¼æ˜¾ç¤º */
        .formula-box {
            background: linear-gradient(135deg,
                rgba(0, 0, 0, 0.6) 0%,
                rgba(20, 20, 30, 0.5) 100%);
            padding: 12px;
            border-radius: 8px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.82em;
            color: #ffd93d;
            margin: 10px 0;
            border: 1px solid rgba(255, 217, 61, 0.3);
            line-height: 1.7;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 1px rgba(255, 217, 61, 0.1);
            transition: all 0.3s;
        }
        
        .formula-box:hover {
            border-color: rgba(255, 217, 61, 0.6);
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(255, 217, 61, 0.2);
        }
        
        /* æ»‘å—ç»„ */
        .slider-group {
            margin: 12px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            color: #bbb;
            font-size: 0.82em;
            margin-bottom: 8px;
        }
        
        .slider-label span {
            color: #00d4ff;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, 
                rgba(123, 47, 247, 0.3), 
                rgba(0, 212, 255, 0.3));
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #00d4ff, #7b2ff7);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 
                0 0 8px rgba(0, 212, 255, 0.8),
                0 2px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 
                0 0 20px rgba(0, 212, 255, 1),
                0 4px 10px rgba(0, 0, 0, 0.4);
        }
        
        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.1);
        }
        
        /* æŒ‰é’®ç½‘æ ¼ */
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        button {
            padding: 11px;
            background: linear-gradient(135deg, #7b2ff7 0%, #f107a3 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 0.82em;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(123, 47, 247, 0.3);
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover::before {
            width: 250px;
            height: 250px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(123, 47, 247, 0.6);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        /* ä¿¡æ¯æ¡† */
        .info-box {
            margin-top: 14px;
            padding: 12px;
            background: linear-gradient(135deg, 
                rgba(0, 212, 255, 0.1), 
                rgba(123, 47, 247, 0.08));
            border-radius: 10px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            font-size: 0.76em;
            line-height: 1.6;
            color: #ccc;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .info-box strong {
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        /* æ§åˆ¶æç¤º */
        .control-hint {
            font-size: 0.72em;
            color: #4CAF50;
            margin-top: 8px;
            padding: 8px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
        }
        
        /* å›¾ä¾‹ */
        .legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: linear-gradient(135deg,
                rgba(10, 14, 26, 0.95) 0%,
                rgba(20, 24, 36, 0.92) 100%);
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            font-size: 0.8em;
            backdrop-filter: blur(25px) saturate(180%);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(0, 212, 255, 0.1);
        }
        
        .legend-title {
            color: #00d4ff;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.95em;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 6px 0;
            transition: all 0.3s;
        }
        
        .legend-item:hover {
            transform: translateX(3px);
        }
        
        .legend-line {
            width: 30px;
            height: 3px;
            border-radius: 2px;
            box-shadow: 0 0 10px currentColor;
        }
        
        /* ç»Ÿè®¡é¢æ¿ */
        .stats-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg,
                rgba(10, 14, 26, 0.95) 0%,
                rgba(20, 24, 36, 0.92) 100%);
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            backdrop-filter: blur(25px) saturate(180%);
            min-width: 160px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(0, 212, 255, 0.1);
        }
        
        .stats-title {
            color: #00d4ff;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.9em;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
            color: #aaa;
            font-size: 0.8em;
        }
        
        .stat-value {
            color: #00d4ff;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
        }
        
        /* ç†è®ºé¢æ¿ */
        .theory-panel {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: linear-gradient(135deg,
                rgba(10, 14, 26, 0.95) 0%,
                rgba(30, 24, 16, 0.92) 100%);
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(255, 217, 61, 0.3);
            backdrop-filter: blur(25px) saturate(180%);
            max-width: 330px;
            font-size: 0.76em;
            line-height: 1.6;
            color: #ccc;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(255, 217, 61, 0.1);
        }
        
        .theory-title {
            color: #ffd93d;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.05em;
            text-shadow: 0 0 10px rgba(255, 217, 61, 0.5);
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 8px;
        }
        
        .progress-label {
            font-size: 0.75em;
            color: #00d4ff;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            border-radius: 3px;
            transition: width 0.3s;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <!-- ä¸»æ§åˆ¶é¢æ¿ -->
    <div class="main-panel">
        <h1>ç»Ÿä¸€åœºè®º</h1>
        <div class="subtitle">ä»å‚ç›´åŸç†åˆ°å››ç§åŸºæœ¬åŠ›çš„å‡ ä½•ç»Ÿä¸€</div>
        
        <!-- æ¨¡å¼é€‰æ‹© -->
        <div class="mode-selector">
            <div class="mode-btn active" data-mode="unified">ğŸŒŒ ç»Ÿä¸€</div>
            <div class="mode-btn" data-mode="separate">ğŸ”¬ åˆ†è§£</div>
            <div class="mode-btn" data-mode="comparison">âš–ï¸ å¯¹æ¯”</div>
            <div class="mode-btn" data-mode="evolution">ğŸ¬ æ¼”åŒ–</div>
        </div>
        
        <!-- å‡ ä½•åŸºç¡€ -->
        <div class="section geo">
            <h3>âš›ï¸ å‚ç›´åŸç†ä¸èºæ—‹è¿åŠ¨</h3>
            <div class="slider-group">
                <div class="slider-label"><span>èºæ—‹åŠå¾„ r</span> <span id="radiusVal">3.5</span></div>
                <input type="range" id="radius" min="2" max="7" step="0.5" value="3.5">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>è§’é€Ÿåº¦ Ï‰</span> <span id="omegaVal">1.0</span></div>
                <input type="range" id="omega" min="0.2" max="3" step="0.1" value="1">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>èºè· h</span> <span id="pitchVal">0.6</span></div>
                <input type="range" id="pitch" min="0.2" max="1.5" step="0.1" value="0.6">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>èºæ—‹åœˆæ•°</span> <span id="turnsVal">5</span></div>
                <input type="range" id="turns" min="3" max="12" value="5">
            </div>
            
            <!-- ç²’å­è¿›åº¦æ˜¾ç¤º -->
            <div class="progress-container">
                <div class="progress-label">ç²’å­è¿åŠ¨è¿›åº¦</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <!-- å››ç§åŸºæœ¬åŠ› -->
        <div class="section force">
            <h3>ğŸ’« å››ç§åŸºæœ¬åŠ›å±•ç¤º</h3>
            
            <div class="force-card active" data-force="gravity">
                <div class="force-info">
                    <div class="force-header">
                        <div class="force-icon" style="background: linear-gradient(135deg, #ff6b6b, #ee5a6f);">ğŸŒ</div>
                        <div class="force-name">å¼•åŠ›/æƒ¯æ€§åŠ›</div>
                    </div>
                    <div class="force-origin">æºè‡ªï¼šç›´çº¿è¿åŠ¨åˆ†é‡é€Ÿåº¦å˜åŒ– (dV/dt)</div>
                    <div class="force-direction">â†’ æ–¹å‘ï¼šæŒ‡å‘è´¨é‡ä¸­å¿ƒæˆ–åŠ é€Ÿåº¦åå‘</div>
                </div>
                <div class="toggle-switch active"></div>
            </div>
            
            <div class="force-card active" data-force="electric">
                <div class="force-info">
                    <div class="force-header">
                        <div class="force-icon" style="background: linear-gradient(135deg, #ffd93d, #f6c23e);">âš¡</div>
                        <div class="force-name">ç”µåœºåŠ›</div>
                    </div>
                    <div class="force-origin">æºè‡ªï¼šç›´çº¿è¿åŠ¨æµé‡å˜åŒ– (dm/dt)</div>
                    <div class="force-direction">â†’ æ–¹å‘ï¼šæ²¿ç”µè·è¿çº¿ï¼ŒåŒæ–¥å¼‚å¸</div>
                </div>
                <div class="toggle-switch active"></div>
            </div>
            
            <div class="force-card active" data-force="magnetic">
                <div class="force-info">
                    <div class="force-header">
                        <div class="force-icon" style="background: linear-gradient(135deg, #4d94ff, #3a7bd5);">ğŸ§²</div>
                        <div class="force-name">ç£åœºåŠ›</div>
                    </div>
                    <div class="force-origin">æºè‡ªï¼šæ—‹è½¬è¿åŠ¨åˆ†é‡å˜åŒ– (-VÂ·dm/dt)</div>
                    <div class="force-direction">â†’ æ–¹å‘ï¼šå‚ç›´äºé€Ÿåº¦ä¸ç£åœºå¹³é¢</div>
                </div>
                <div class="toggle-switch active"></div>
            </div>
            
            <div class="force-card active" data-force="nuclear">
                <div class="force-info">
                    <div class="force-header">
                        <div class="force-icon" style="background: linear-gradient(135deg, #a78bfa, #8b5cf6);">â˜¢ï¸</div>
                        <div class="force-name">æ ¸åŠ›</div>
                    </div>
                    <div class="force-origin">æºè‡ªï¼šå…‰é€ŸçŸ¢é‡æ–¹å‘å‰§çƒˆå˜åŒ– (dC/dt)</div>
                    <div class="force-direction">â†’ æ–¹å‘ï¼šçŸ­ç¨‹æŸç¼šï¼Œæå¼ºå¤æ‚</div>
                </div>
                <div class="toggle-switch active"></div>
            </div>
        </div>
        
        <!-- ç»Ÿä¸€å…¬å¼ -->
        <div class="section formula">
            <h3>ğŸ“ å®‡å®™å¤§ç»Ÿä¸€æ–¹ç¨‹</h3>
            <div class="formula-box">
F = CÂ·dm/dt - VÂ·dm/dt + mÂ·dC/dt - mÂ·dV/dt
            </div>
            <div style="font-size: 0.7em; color: #888; margin-top: 6px;">
                ç”µåœºåŠ› + ç£åœºåŠ› + æ ¸åŠ› + å¼•åŠ›/æƒ¯æ€§åŠ›
            </div>
        </div>
        
        <!-- ç›¸æœºæ§åˆ¶ -->
        <div class="section camera">
            <h3>ğŸ“¹ 3Dèˆå°æ§åˆ¶</h3>
            <div class="slider-group">
                <div class="slider-label"><span>ç›¸æœºè·ç¦»</span> <span id="cameraDistVal">32</span></div>
                <input type="range" id="cameraDist" min="15" max="60" value="32">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>è‡ªåŠ¨æ—‹è½¬é€Ÿåº¦</span> <span id="autoRotateVal">0.5</span></div>
                <input type="range" id="autoRotate" min="0" max="2" step="0.1" value="0.5">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>è§†é‡è§’åº¦ FOV</span> <span id="fovVal">60</span></div>
                <input type="range" id="fov" min="40" max="90" value="60">
            </div>
            <div class="control-hint">
                ğŸ–±ï¸ æ‹–åŠ¨æ—‹è½¬ | ğŸ” æ»šè½®ç¼©æ”¾ | âŒ¨ï¸ ç©ºæ ¼æš‚åœ
            </div>
        </div>
        
        <!-- æ§åˆ¶é€‰é¡¹ -->
        <div class="section control">
            <h3>ğŸ® è§†è§‰æ§åˆ¶</h3>
            <div class="slider-group">
                <div class="slider-label"><span>ç²’å­æ•°é‡</span> <span id="particlesVal">12</span></div>
                <input type="range" id="particles" min="5" max="30" value="12">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>ç²’å­å¤§å°</span> <span id="particleSizeVal">1.0</span></div>
                <input type="range" id="particleSize" min="0.5" max="2" step="0.1" value="1">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>å‘é‡é•¿åº¦</span> <span id="vectorLenVal">1.2</span></div>
                <input type="range" id="vectorLen" min="0.5" max="2.5" step="0.1" value="1.2">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>å‘é‡ç²—ç»†</span> <span id="vectorWidthVal">2</span></div>
                <input type="range" id="vectorWidth" min="1" max="5" value="2">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>è¿åŠ¨é€Ÿåº¦</span> <span id="speedVal">1.0</span></div>
                <input type="range" id="speed" min="0.1" max="3" step="0.1" value="1">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>è½¨è¿¹é•¿åº¦</span> <span id="trailLenVal">80</span></div>
                <input type="range" id="trailLen" min="30" max="150" value="80">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>è½¨è¿¹é€æ˜åº¦</span> <span id="trailOpacityVal">0.5</span></div>
                <input type="range" id="trailOpacity" min="0.1" max="1" step="0.1" value="0.5">
            </div>
            <div class="btn-grid">
                <button id="toggleVectors">å‘é‡ ON</button>
                <button id="toggleTrails">è½¨è¿¹ ON</button>
                <button id="toggleAxes">åæ ‡è½´ ON</button>
                <button id="toggleGlow">å…‰æ™• ON</button>
                <button id="toggleRainbow">å½©è™¹ ON</button>
                <button id="resetView">é‡ç½®è§†è§’</button>
            </div>
        </div>
        
        <div class="info-box">
            <strong>ğŸ”¬ ç»Ÿä¸€åœºè®ºæ ¸å¿ƒï¼š</strong><br>
            å‚ç›´åŸç†è¦æ±‚ç©ºé—´ä»¥ä¸‰ç»´èºæ—‹æ–¹å¼è¿åŠ¨ã€‚ç²’å­å°†å®Œæ•´åœ°æ²¿èºæ—‹çº¿è¿åŠ¨ä¸€æ•´åœˆï¼Œå±•ç¤ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„å®Œæ•´è½¨è¿¹ã€‚å››ç§åŸºæœ¬åŠ›çš„æ–¹å‘æ˜¯è¿™ç§èºæ—‹è¿åŠ¨çš„å‡ ä½•ä½“ç°ã€‚
        </div>
    </div>
    
    <!-- å›¾ä¾‹ -->
    <div class="legend">
        <div class="legend-title">åŠ›åœºå‘é‡å›¾ä¾‹</div>
        <div class="legend-item">
            <div class="legend-line" style="background: #ff6b6b;"></div>
            <span>å¼•åŠ›åœºï¼ˆæŒ‡å‘ä¸­å¿ƒï¼‰</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #ffd93d;"></div>
            <span>ç”µåœºï¼ˆå¾„å‘å‘æ•£/æ±‡èšï¼‰</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #4d94ff;"></div>
            <span>ç£åœºï¼ˆå‚ç›´å¹³é¢ï¼‰</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #a78bfa;"></div>
            <span>æ ¸åŠ›åœºï¼ˆå¤æ‚æ–¹å‘ï¼‰</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #00d4ff;"></div>
            <span>èºæ—‹è½¨è¿¹</span>
        </div>
    </div>
    
    <!-- ç»Ÿè®¡é¢æ¿ -->
    <div class="stats-panel">
        <div class="stats-title">ç³»ç»ŸçŠ¶æ€</div>
        <div class="stat-item">
            <span>FPS</span>
            <span class="stat-value" id="fps">60</span>
        </div>
        <div class="stat-item">
            <span>ç²’å­æ•°</span>
            <span class="stat-value" id="particleCount">0</span>
        </div>
        <div class="stat-item">
            <span>åŠ›å‘é‡</span>
            <span class="stat-value" id="vectorCount">0</span>
        </div>
        <div class="stat-item">
            <span>ç›¸æœºè§’åº¦</span>
            <span class="stat-value" id="cameraAngle">0Â°</span>
        </div>
    </div>
    
    <!-- ç†è®ºé¢æ¿ -->
    <div class="theory-panel">
        <div class="theory-title">ç»Ÿä¸€æ¨¡å¼</div>
        <div id="theoryContent">
å±•ç¤ºå®Œæ•´çš„ä¸‰ç»´èºæ—‹è¿åŠ¨åŠå…¶åˆ†è§£å‡ºçš„å››ç§åŸºæœ¬åŠ›ã€‚æ¯ä¸ªç²’å­æ²¿èºæ—‹è½¨è¿¹å®Œæ•´è¿åŠ¨ï¼Œä»èµ·ç‚¹åˆ°ç»ˆç‚¹å±•ç¤ºå…¨ç¨‹ã€‚è¿™æ˜¯å‚ç›´åŸç†æœ€ç›´æ¥çš„å‡ ä½•ä½“ç°ã€‚
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ============ å…¨å±€å˜é‡ ============
        let scene, camera, renderer;
        let spiralGroup;
        let particles = [];
        let forceVectors = { gravity: [], electric: [], magnetic: [], nuclear: [] };
        
        // çŠ¶æ€ç®¡ç†
        const state = {
            mode: 'unified',
            showVectors: true,
            showTrails: true,
            showAxes: true,
            showGlow: true,
            showRainbow: true,
            isPaused: false,
            isDragging: false,
            forces: {
                gravity: true,
                electric: true,
                magnetic: true,
                nuclear: true
            }
        };
        
        // é…ç½®å‚æ•°
        const config = {
            radius: 3.5,
            omega: 1.0,
            pitch: 0.6,
            turns: 5,
            particleCount: 12,
            particleSize: 1.0,
            vectorLength: 1.2,
            vectorWidth: 2,
            speed: 1.0,
            cameraDist: 32,
            autoRotateSpeed: 0.5,
            fov: 60,
            trailLength: 80,
            trailOpacity: 0.5
        };
        
        // ç›¸æœºæ§åˆ¶
        let mouseX = 0, mouseY = 0;
        let lastMouseX = 0, lastMouseY = 0;
        let targetRotX = 0.3, targetRotY = 0.2;
        let currentRotX = 0.3, currentRotY = 0.2;
        let autoRotateAngle = 0;
        
        // æ€§èƒ½ç›‘æ§
        let frameCount = 0;
        let lastFpsTime = 0;
        let animTime = 0;
        
        // ============ åˆå§‹åŒ– ============
        function init() {
            try {
                // åœºæ™¯è®¾ç½®
                scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x000000, 0.008);
                
                // ç›¸æœºè®¾ç½®
                camera = new THREE.PerspectiveCamera(
                    config.fov,
                    window.innerWidth / window.innerHeight,
                    0.1,
                    1000
                );
                updateCameraPosition();
                
                // æ¸²æŸ“å™¨è®¾ç½®
                renderer = new THREE.WebGLRenderer({
                    antialias: true,
                    alpha: true,
                    powerPreference: "high-performance"
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                renderer.setClearColor(0x000000, 1);
                document.getElementById('container').appendChild(renderer.domElement);
                
                // å…‰ç…§ç³»ç»Ÿ
                setupLights();
                
                // åˆ›å»ºæ˜Ÿç©º
                createStarfield();
                
                // åˆ›å»ºåæ ‡è½´
                createAxes();
                
                // åˆ›å»ºèºæ—‹ç³»ç»Ÿ
                spiralGroup = new THREE.Group();
                scene.add(spiralGroup);
                createSpiralSystem();
                
                // äº‹ä»¶ç›‘å¬
                setupControls();
                setupMouseControls();
                window.addEventListener('resize', onResize, false);
                window.addEventListener('keydown', onKeyDown, false);
                
                // å¼€å§‹åŠ¨ç”»
                lastFpsTime = performance.now();
                animate();
                
            } catch (error) {
                console.error('åˆå§‹åŒ–é”™è¯¯:', error);
            }
        }
        
        // ============ å…‰ç…§ç³»ç»Ÿ ============
        function setupLights() {
            const ambientLight = new THREE.AmbientLight(0x1a1a2e, 0.6);
            scene.add(ambientLight);
            
            const light1 = new THREE.PointLight(0x00d4ff, 1.5, 150);
            light1.position.set(20, 20, 20);
            scene.add(light1);
            
            const light2 = new THREE.PointLight(0x7b2ff7, 1.3, 150);
            light2.position.set(-20, -15, -20);
            scene.add(light2);
            
            const light3 = new THREE.PointLight(0xf107a3, 1.0, 120);
            light3.position.set(0, -20, 15);
            scene.add(light3);
        }
        
        // ============ æ˜Ÿç©ºèƒŒæ™¯ ============
        function createStarfield() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const colors = [];
            
            for (let i = 0; i < 6000; i++) {
                vertices.push(
                    (Math.random() - 0.5) * 250,
                    (Math.random() - 0.5) * 250,
                    (Math.random() - 0.5) * 250
                );
                
                const color = new THREE.Color();
                color.setHSL(Math.random() * 0.2 + 0.5, 0.7, 0.5 + Math.random() * 0.4);
                colors.push(color.r, color.g, color.b);
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.35,
                vertexColors: true,
                transparent: true,
                opacity: 0.85,
                blending: THREE.AdditiveBlending
            });
            
            const starField = new THREE.Points(geometry, material);
            scene.add(starField);
        }
        
        // ============ åæ ‡è½´ç³»ç»Ÿ ============
        function createAxes() {
            const axesGroup = new THREE.Group();
            axesGroup.name = 'axes';
            const length = 20;
            
            const axisData = [
                { color: 0xff6b6b, dir: [1, 0, 0] },
                { color: 0x6bff6b, dir: [0, 1, 0] },
                { color: 0x6b6bff, dir: [0, 0, 1] }
            ];
            
            axisData.forEach(axis => {
                const material = new THREE.LineBasicMaterial({
                    color: axis.color,
                    transparent: true,
                    opacity: 0.6
                });
                
                const posPoints = [
                    new THREE.Vector3(0, 0, 0),
                    new THREE.Vector3(axis.dir[0] * length, axis.dir[1] * length, axis.dir[2] * length)
                ];
                const posGeometry = new THREE.BufferGeometry().setFromPoints(posPoints);
                const posLine = new THREE.Line(posGeometry, material);
                axesGroup.add(posLine);
                
                const negPoints = [
                    new THREE.Vector3(0, 0, 0),
                    new THREE.Vector3(-axis.dir[0] * length, -axis.dir[1] * length, -axis.dir[2] * length)
                ];
                const negGeometry = new THREE.BufferGeometry().setFromPoints(negPoints);
                const negLine = new THREE.Line(negGeometry, material);
                axesGroup.add(negLine);
            });
            
            scene.add(axesGroup);
        }
        
        // ============ åˆ›å»ºèºæ—‹ç³»ç»Ÿ ============
        function createSpiralSystem() {
            spiralGroup.clear();
            particles = [];
            forceVectors = { gravity: [], electric: [], magnetic: [], nuclear: [] };
            
            // åˆ›å»ºèºæ—‹çº¿
            const points = [];
            const segments = 400;
            for (let i = 0; i <= segments; i++) {
                const t = (i / segments) * config.turns * Math.PI * 2;
                const x = config.radius * Math.cos(t);
                const y = config.pitch * t - config.turns * Math.PI * config.pitch;
                const z = config.radius * Math.sin(t);
                points.push(new THREE.Vector3(x, y, z));
            }
            
            const spiralGeometry = new THREE.BufferGeometry().setFromPoints(points);
            const spiralMaterial = new THREE.LineBasicMaterial({
                color: 0x00d4ff,
                transparent: true,
                opacity: 0.5
            });
            const spiralLine = new THREE.Line(spiralGeometry, spiralMaterial);
            spiralGroup.add(spiralLine);
            
            // åˆ›å»ºç²’å­
            for (let i = 0; i < config.particleCount; i++) {
                const particle = {
                    progress: i / config.particleCount,
                    mesh: null,
                    trailPoints: [],
                    trail: null,
                    glow: null
                };
                
                // ç²’å­çƒï¼ˆæ›´é«˜è´¨é‡ï¼‰
                const baseSize = 0.2 * config.particleSize;
                const sphereGeom = new THREE.SphereGeometry(baseSize, 24, 24);
                const sphereMat = new THREE.MeshPhongMaterial({
                    color: 0x00d4ff,
                    emissive: 0x0099dd,
                    shininess: 120,
                    transparent: true,
                    opacity: 0.95,
                    specular: 0xffffff
                });
                particle.mesh = new THREE.Mesh(sphereGeom, sphereMat);
                spiralGroup.add(particle.mesh);
                
                // ç²’å­å…‰æ™•ï¼ˆå¯é€‰ï¼‰
                const glowGeom = new THREE.SphereGeometry(baseSize * 1.8, 16, 16);
                const glowMat = new THREE.MeshBasicMaterial({
                    color: 0x00d4ff,
                    transparent: true,
                    opacity: 0.3,
                    blending: THREE.AdditiveBlending,
                    depthWrite: false
                });
                particle.glow = new THREE.Mesh(glowGeom, glowMat);
                spiralGroup.add(particle.glow);
                
                // è½¨è¿¹ï¼ˆæ¸å˜é¢œè‰²ï¼‰
                const trailGeom = new THREE.BufferGeometry();
                const trailMat = new THREE.LineBasicMaterial({
                    color: 0x00d4ff,
                    transparent: true,
                    opacity: config.trailOpacity,
                    linewidth: 2
                });
                particle.trail = new THREE.Line(trailGeom, trailMat);
                spiralGroup.add(particle.trail);
                
                // åŠ›å‘é‡ï¼ˆæ›´ç²—çš„çº¿æ¡ï¼‰
                const forceTypes = [
                    { name: 'gravity', color: 0xff6b6b },
                    { name: 'electric', color: 0xffd93d },
                    { name: 'magnetic', color: 0x4d94ff },
                    { name: 'nuclear', color: 0xa78bfa }
                ];
                
                forceTypes.forEach(force => {
                    const vectorGeom = new THREE.BufferGeometry();
                    const positions = new Float32Array(6);
                    vectorGeom.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                    
                    // ä½¿ç”¨æ›´ç²—çš„çº¿æ¡
                    const vectorMat = new THREE.LineBasicMaterial({
                        color: force.color,
                        transparent: true,
                        opacity: 0.85,
                        linewidth: config.vectorWidth
                    });
                    const vector = new THREE.Line(vectorGeom, vectorMat);
                    spiralGroup.add(vector);
                    
                    if (!forceVectors[force.name]) forceVectors[force.name] = [];
                    forceVectors[force.name].push(vector);
                });
                
                particles.push(particle);
            }
            
            updateStats();
        }
        
        // ============ æ›´æ–°ç²’å­ï¼ˆå®Œæ•´èºæ—‹è¿åŠ¨ï¼‰============
        function updateParticles() {
            let maxProgress = 0;
            
            particles.forEach((p, idx) => {
                // æ¯ä¸ªç²’å­å®Œæ•´è·‘å®Œèºæ—‹çº¿ï¼ˆä»0åˆ°1çš„å®Œæ•´å‘¨æœŸï¼‰
                const cycleTime = 10000; // 10ç§’å®Œæˆä¸€ä¸ªå®Œæ•´å‘¨æœŸ
                const baseT = ((animTime * config.speed) % cycleTime) / cycleTime;
                const offsetT = (idx / config.particleCount);
                let t = (baseT + offsetT) % 1; // å½“å‰ç²’å­åœ¨èºæ—‹çº¿ä¸Šçš„ä½ç½®ï¼ˆ0åˆ°1ï¼‰
                
                // è®¡ç®—èºæ—‹çº¿ä¸Šçš„å®é™…ä½ç½®
                const totalAngle = t * config.turns * Math.PI * 2; // æ€»æ—‹è½¬è§’åº¦
                
                const x = config.radius * Math.cos(totalAngle);
                const y = config.pitch * totalAngle - config.turns * Math.PI * config.pitch;
                const z = config.radius * Math.sin(totalAngle);
                
                p.mesh.position.set(x, y, z);
                if (p.glow) {
                    p.glow.position.set(x, y, z);
                    p.glow.visible = state.showGlow;
                }
                
                // è®°å½•æœ€å¤§è¿›åº¦ï¼ˆç”¨äºè¿›åº¦æ¡æ˜¾ç¤ºï¼‰
                maxProgress = Math.max(maxProgress, t);
                
                // ç²’å­é¢œè‰²éšè¿›åº¦å˜åŒ–ï¼ˆå½©è™¹æ•ˆæœå¯é€‰ï¼‰
                if (state.showRainbow) {
                    const hue = t * 0.6; // ä»é’è‰²åˆ°ç´«è‰²
                    p.mesh.material.color.setHSL(0.5 + hue * 0.3, 1, 0.6);
                    p.mesh.material.emissive.setHSL(0.5 + hue * 0.3, 1, 0.4);
                    if (p.glow) {
                        p.glow.material.color.setHSL(0.5 + hue * 0.3, 1, 0.6);
                    }
                    if (p.trail.visible) {
                        p.trail.material.color.setHSL(0.5 + hue * 0.3, 1, 0.5);
                    }
                } else {
                    // é»˜è®¤é’è‰²
                    p.mesh.material.color.setHex(0x00d4ff);
                    p.mesh.material.emissive.setHex(0x0099dd);
                    if (p.glow) {
                        p.glow.material.color.setHex(0x00d4ff);
                    }
                    if (p.trail.visible) {
                        p.trail.material.color.setHex(0x00d4ff);
                    }
                }
                
                // ç²’å­å¤§å°è„‰åŠ¨æ•ˆæœ
                const pulse = 1 + Math.sin(animTime * 0.003 + idx) * 0.1;
                p.mesh.scale.set(pulse, pulse, pulse);
                
                // è½¨è¿¹
                if (state.showTrails) {
                    p.trailPoints.push(new THREE.Vector3(x, y, z));
                    if (p.trailPoints.length > config.trailLength) p.trailPoints.shift();
                    
                    // å½“ç²’å­å®Œæˆä¸€åœˆæ—¶ï¼Œæ¸…ç©ºè½¨è¿¹é‡æ–°å¼€å§‹
                    if (t < 0.01 && p.trailPoints.length > 10) {
                        p.trailPoints = [];
                    }
                    
                    if (p.trailPoints.length > 1) {
                        p.trail.geometry.setFromPoints(p.trailPoints);
                        p.trail.material.opacity = config.trailOpacity;
                        p.trail.visible = true;
                    }
                } else {
                    p.trail.visible = false;
                }
                
                // åŠ›å‘é‡æ›´æ–°
                if (state.showVectors) {
                    const vecLen = config.vectorLength;
                    
                    // 1. å¼•åŠ›å‘é‡ - æŒ‡å‘ä¸­å¿ƒ
                    if (state.forces.gravity && forceVectors.gravity[idx]) {
                        const gravDir = new THREE.Vector3(-x, -y, -z).normalize().multiplyScalar(vecLen);
                        const pos = forceVectors.gravity[idx].geometry.attributes.position.array;
                        pos[0] = x; pos[1] = y; pos[2] = z;
                        pos[3] = x + gravDir.x; pos[4] = y + gravDir.y; pos[5] = z + gravDir.z;
                        forceVectors.gravity[idx].geometry.attributes.position.needsUpdate = true;
                        forceVectors.gravity[idx].visible = true;
                    } else if (forceVectors.gravity[idx]) {
                        forceVectors.gravity[idx].visible = false;
                    }
                    
                    // 2. ç”µåœºå‘é‡ - å¾„å‘å‘æ•£
                    if (state.forces.electric && forceVectors.electric[idx]) {
                        const elecDir = new THREE.Vector3(x, 0, z).normalize().multiplyScalar(vecLen);
                        const pos = forceVectors.electric[idx].geometry.attributes.position.array;
                        pos[0] = x; pos[1] = y; pos[2] = z;
                        pos[3] = x + elecDir.x; pos[4] = y + elecDir.y; pos[5] = z + elecDir.z;
                        forceVectors.electric[idx].geometry.attributes.position.needsUpdate = true;
                        forceVectors.electric[idx].visible = true;
                    } else if (forceVectors.electric[idx]) {
                        forceVectors.electric[idx].visible = false;
                    }
                    
                    // 3. ç£åœºå‘é‡ - å‚ç›´äºè¿åŠ¨å¹³é¢
                    if (state.forces.magnetic && forceVectors.magnetic[idx]) {
                        const tangent = new THREE.Vector3(-Math.sin(totalAngle), 0, Math.cos(totalAngle)).normalize();
                        const radial = new THREE.Vector3(Math.cos(totalAngle), 0, Math.sin(totalAngle)).normalize();
                        const magDir = new THREE.Vector3().crossVectors(tangent, radial).normalize().multiplyScalar(vecLen);
                        const pos = forceVectors.magnetic[idx].geometry.attributes.position.array;
                        pos[0] = x; pos[1] = y; pos[2] = z;
                        pos[3] = x + magDir.x; pos[4] = y + magDir.y; pos[5] = z + magDir.z;
                        forceVectors.magnetic[idx].geometry.attributes.position.needsUpdate = true;
                        forceVectors.magnetic[idx].visible = true;
                    } else if (forceVectors.magnetic[idx]) {
                        forceVectors.magnetic[idx].visible = false;
                    }
                    
                    // 4. æ ¸åŠ›å‘é‡ - å¤æ‚æ–¹å‘
                    if (state.forces.nuclear && forceVectors.nuclear[idx]) {
                        const nucDir = new THREE.Vector3(
                            Math.sin(totalAngle * 3 + animTime * 0.001),
                            Math.cos(totalAngle * 2 - animTime * 0.0008),
                            Math.sin(totalAngle * 5 + animTime * 0.0012)
                        ).normalize().multiplyScalar(vecLen * 0.75);
                        const pos = forceVectors.nuclear[idx].geometry.attributes.position.array;
                        pos[0] = x; pos[1] = y; pos[2] = z;
                        pos[3] = x + nucDir.x; pos[4] = y + nucDir.y; pos[5] = z + nucDir.z;
                        forceVectors.nuclear[idx].geometry.attributes.position.needsUpdate = true;
                        forceVectors.nuclear[idx].visible = true;
                    } else if (forceVectors.nuclear[idx]) {
                        forceVectors.nuclear[idx].visible = false;
                    }
                } else {
                    Object.values(forceVectors).forEach(vectors => {
                        vectors.forEach(v => v.visible = false);
                    });
                }
            });
            
            // æ›´æ–°è¿›åº¦æ¡ï¼ˆæ˜¾ç¤ºç¬¬ä¸€ä¸ªç²’å­çš„è¿›åº¦ï¼‰
            const progressFill = document.getElementById('progressFill');
            if (progressFill && particles.length > 0) {
                const cycleTime = 10000;
                const firstParticleProgress = (((animTime * config.speed) % cycleTime) / cycleTime);
                progressFill.style.width = (firstParticleProgress * 100) + '%';
            }
        }
        
        // ============ åŠ¨ç”»å¾ªç¯ ============
        function animate() {
            requestAnimationFrame(animate);
            
            if (!state.isPaused) {
                const now = performance.now();
                animTime = now;
                
                // FPSè®¡æ•°
                frameCount++;
                if (now - lastFpsTime >= 1000) {
                    document.getElementById('fps').textContent = frameCount;
                    frameCount = 0;
                    lastFpsTime = now;
                }
                
                // æ›´æ–°ç²’å­
                updateParticles();
                
                // è‡ªåŠ¨æ—‹è½¬
                if (config.autoRotateSpeed > 0 && !state.isDragging) {
                    autoRotateAngle += 0.001 * config.autoRotateSpeed;
                    spiralGroup.rotation.y = autoRotateAngle;
                }
                
                // ç›¸æœºå¹³æ»‘ç§»åŠ¨
                currentRotX += (targetRotX - currentRotX) * 0.08;
                currentRotY += (targetRotY - currentRotY) * 0.08;
                
                updateCameraPosition();
                
                // æ›´æ–°ç›¸æœºè§’åº¦æ˜¾ç¤º
                const angle = Math.round((currentRotX / Math.PI) * 180);
                const angleElem = document.getElementById('cameraAngle');
                if (angleElem) angleElem.textContent = angle + 'Â°';
            }
            
            renderer.render(scene, camera);
        }
        
        // ============ æ›´æ–°ç›¸æœºä½ç½® ============
        function updateCameraPosition() {
            const dist = config.cameraDist;
            camera.position.x = dist * Math.sin(currentRotX) * Math.cos(currentRotY);
            camera.position.z = dist * Math.cos(currentRotX) * Math.cos(currentRotY);
            camera.position.y = dist * Math.sin(currentRotY);
            camera.lookAt(0, 0, 0);
        }
        
        // ============ é¼ æ ‡æ§åˆ¶ ============
        function setupMouseControls() {
            let isDragging = false;
            
            document.addEventListener('mousedown', (e) => {
                isDragging = true;
                state.isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                document.body.classList.add('grabbing');
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - lastMouseX;
                    const deltaY = e.clientY - lastMouseY;
                    
                    targetRotX += deltaX * 0.01;
                    targetRotY = Math.max(-Math.PI/2 + 0.1, Math.min(Math.PI/2 - 0.1, targetRotY - deltaY * 0.01));
                    
                    lastMouseX = e.clientX;
                    lastMouseY = e.clientY;
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
                state.isDragging = false;
                document.body.classList.remove('grabbing');
            });
            
            document.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY * 0.02;
                config.cameraDist = Math.max(15, Math.min(60, config.cameraDist + delta));
                const distElem = document.getElementById('cameraDistVal');
                if (distElem) distElem.textContent = config.cameraDist.toFixed(1);
                const distSlider = document.getElementById('cameraDist');
                if (distSlider) distSlider.value = config.cameraDist;
                updateCameraPosition();
            }, { passive: false });
        }
        
        // ============ é”®ç›˜æ§åˆ¶ ============
        function onKeyDown(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                state.isPaused = !state.isPaused;
            }
        }
        
        // ============ æ§åˆ¶è®¾ç½® ============
        function setupControls() {
            // æ¨¡å¼åˆ‡æ¢
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.mode = btn.dataset.mode;
                    updateModeDisplay();
                });
            });
            
            // æ»‘å—æ§åˆ¶
            const sliders = {
                radius: { id: 'radius', display: 'radiusVal', prop: 'radius', rebuild: true },
                omega: { id: 'omega', display: 'omegaVal', prop: 'omega', rebuild: false },
                pitch: { id: 'pitch', display: 'pitchVal', prop: 'pitch', rebuild: true },
                turns: { id: 'turns', display: 'turnsVal', prop: 'turns', rebuild: true },
                particles: { id: 'particles', display: 'particlesVal', prop: 'particleCount', rebuild: true },
                particleSize: { id: 'particleSize', display: 'particleSizeVal', prop: 'particleSize', rebuild: true },
                vectorLen: { id: 'vectorLen', display: 'vectorLenVal', prop: 'vectorLength', rebuild: false },
                vectorWidth: { id: 'vectorWidth', display: 'vectorWidthVal', prop: 'vectorWidth', rebuild: true },
                speed: { id: 'speed', display: 'speedVal', prop: 'speed', rebuild: false },
                cameraDist: { id: 'cameraDist', display: 'cameraDistVal', prop: 'cameraDist', rebuild: false },
                autoRotate: { id: 'autoRotate', display: 'autoRotateVal', prop: 'autoRotateSpeed', rebuild: false },
                fov: { id: 'fov', display: 'fovVal', prop: 'fov', rebuild: false },
                trailLen: { id: 'trailLen', display: 'trailLenVal', prop: 'trailLength', rebuild: false },
                trailOpacity: { id: 'trailOpacity', display: 'trailOpacityVal', prop: 'trailOpacity', rebuild: false }
            };
            
            Object.values(sliders).forEach(slider => {
                const elem = document.getElementById(slider.id);
                if (elem) {
                    elem.addEventListener('input', (e) => {
                        const val = parseFloat(e.target.value);
                        config[slider.prop] = val;
                        const display = document.getElementById(slider.display);
                        if (display) display.textContent = val.toFixed(1);
                        
                        if (slider.prop === 'fov') {
                            camera.fov = val;
                            camera.updateProjectionMatrix();
                        } else if (slider.prop === 'cameraDist') {
                            updateCameraPosition();
                        } else if (slider.rebuild) {
                            createSpiralSystem();
                        }
                    });
                }
            });
            
            // åŠ›ç±»å‹åˆ‡æ¢
            document.querySelectorAll('.force-card').forEach(card => {
                card.addEventListener('click', () => {
                    const force = card.dataset.force;
                    state.forces[force] = !state.forces[force];
                    card.classList.toggle('active');
                    const toggle = card.querySelector('.toggle-switch');
                    if (toggle) toggle.classList.toggle('active');
                    updateStats();
                });
            });
            
            // æŒ‰é’®æ§åˆ¶
            const toggleVectorsBtn = document.getElementById('toggleVectors');
            if (toggleVectorsBtn) {
                toggleVectorsBtn.addEventListener('click', function() {
                    state.showVectors = !state.showVectors;
                    this.textContent = state.showVectors ? 'å‘é‡ ON' : 'å‘é‡ OFF';
                });
            }
            
            const toggleTrailsBtn = document.getElementById('toggleTrails');
            if (toggleTrailsBtn) {
                toggleTrailsBtn.addEventListener('click', function() {
                    state.showTrails = !state.showTrails;
                    this.textContent = state.showTrails ? 'è½¨è¿¹ ON' : 'è½¨è¿¹ OFF';
                    if (!state.showTrails) particles.forEach(p => p.trailPoints = []);
                });
            }
            
            const toggleAxesBtn = document.getElementById('toggleAxes');
            if (toggleAxesBtn) {
                toggleAxesBtn.addEventListener('click', function() {
                    state.showAxes = !state.showAxes;
                    const axes = scene.getObjectByName('axes');
                    if (axes) axes.visible = state.showAxes;
                    this.textContent = state.showAxes ? 'åæ ‡è½´ ON' : 'åæ ‡è½´ OFF';
                });
            }
            
            const toggleGlowBtn = document.getElementById('toggleGlow');
            if (toggleGlowBtn) {
                toggleGlowBtn.addEventListener('click', function() {
                    state.showGlow = !state.showGlow;
                    this.textContent = state.showGlow ? 'å…‰æ™• ON' : 'å…‰æ™• OFF';
                });
            }
            
            const toggleRainbowBtn = document.getElementById('toggleRainbow');
            if (toggleRainbowBtn) {
                toggleRainbowBtn.addEventListener('click', function() {
                    state.showRainbow = !state.showRainbow;
                    this.textContent = state.showRainbow ? 'å½©è™¹ ON' : 'å½©è™¹ OFF';
                });
            }
            
            const resetViewBtn = document.getElementById('resetView');
            if (resetViewBtn) {
                resetViewBtn.addEventListener('click', () => {
                    targetRotX = 0.3;
                    targetRotY = 0.2;
                    currentRotX = 0.3;
                    currentRotY = 0.2;
                    config.cameraDist = 32;
                    autoRotateAngle = 0;
                    spiralGroup.rotation.y = 0;
                    updateCameraPosition();
                    
                    const distSlider = document.getElementById('cameraDist');
                    if (distSlider) distSlider.value = 32;
                    const distElem = document.getElementById('cameraDistVal');
                    if (distElem) distElem.textContent = '32.0';
                });
            }
        }
        
        // ============ æ›´æ–°æ¨¡å¼æ˜¾ç¤º ============
        function updateModeDisplay() {
            const theoryContent = document.getElementById('theoryContent');
            const theoryTitle = document.querySelector('.theory-title');
            
            if (!theoryContent || !theoryTitle) return;
            
            const modes = {
                unified: {
                    title: 'ç»Ÿä¸€æ¨¡å¼',
                    content: 'å±•ç¤ºå®Œæ•´çš„ä¸‰ç»´èºæ—‹è¿åŠ¨åŠå…¶åˆ†è§£å‡ºçš„å››ç§åŸºæœ¬åŠ›ã€‚æ¯ä¸ªç²’å­æ²¿èºæ—‹è½¨è¿¹å®Œæ•´è¿åŠ¨ï¼Œä»èµ·ç‚¹åˆ°ç»ˆç‚¹å±•ç¤ºå…¨ç¨‹ã€‚è¿™æ˜¯å‚ç›´åŸç†æœ€ç›´æ¥çš„å‡ ä½•ä½“ç°ã€‚'
                },
                separate: {
                    title: 'åˆ†è§£æ¨¡å¼',
                    content: 'å°†èºæ—‹è¿åŠ¨åˆ†è§£ä¸ºç›´çº¿è¿åŠ¨åˆ†é‡å’Œæ—‹è½¬è¿åŠ¨åˆ†é‡ã€‚å¼•åŠ›å’Œç”µåœºåŠ›æºäºç›´çº¿åˆ†é‡çš„å˜åŒ–ï¼Œç£åœºåŠ›æºäºæ—‹è½¬åˆ†é‡çš„å˜åŒ–ï¼Œæ ¸åŠ›æºäºå…‰é€ŸçŸ¢é‡çš„å‰§çƒˆæ–¹å‘å˜åŒ–ã€‚'
                },
                comparison: {
                    title: 'å¯¹æ¯”æ¨¡å¼',
                    content: 'å¯¹æ¯”å››ç§åŠ›çš„æ–¹å‘ç‰¹å¾ï¼šå¼•åŠ›æŒ‡å‘è´¨é‡ä¸­å¿ƒï¼Œç”µåœºæ²¿å¾„å‘å‘æ•£æˆ–æ±‡èšï¼Œç£åœºå§‹ç»ˆå‚ç›´äºè¿åŠ¨å¹³é¢ï¼Œæ ¸åŠ›åœ¨å¾®è§‚å°ºåº¦å‘ˆç°å¤æ‚å¤šå˜çš„æ–¹å‘ã€‚æ­ç¤ºåŠ›çš„æ–¹å‘æ˜¯å‡ ä½•è¿åŠ¨å˜åŒ–çš„å¿…ç„¶ç»“æœã€‚'
                },
                evolution: {
                    title: 'æ¼”åŒ–æ¨¡å¼',
                    content: 'åŠ¨æ€å±•ç¤ºä»å‚ç›´åŸç†â†’èºæ—‹è¿åŠ¨â†’è¿åŠ¨å˜åŒ–â†’åŠ›çš„äº§ç”Ÿçš„å®Œæ•´æ¼”åŒ–è¿‡ç¨‹ã€‚ç†è§£åŠ›ä¸æ˜¯è¶…è·ä½œç”¨ï¼Œè€Œæ˜¯ç©ºé—´ä¸ºç»´æŒå…¶ä¸‰ç»´å‚ç›´å‡ ä½•çŠ¶æ€è€Œäº§ç”Ÿçš„è¿åŠ¨å˜åŒ–çš„è¡¨ç°ã€‚'
                }
            };
            
            const mode = modes[state.mode];
            theoryTitle.textContent = mode.title;
            theoryContent.textContent = mode.content;
        }
        
        // ============ æ›´æ–°ç»Ÿè®¡ ============
        function updateStats() {
            const particleCountElem = document.getElementById('particleCount');
            if (particleCountElem) particleCountElem.textContent = particles.length;
            
            const vectorCount = Object.values(state.forces).filter(v => v).length * particles.length;
            const vectorCountElem = document.getElementById('vectorCount');
            if (vectorCountElem) vectorCountElem.textContent = vectorCount;
        }
        
        // ============ çª—å£è°ƒæ•´ ============
        function onResize() {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }
        
        // ============ å¯åŠ¨åº”ç”¨ ============
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>